

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Compute yields &mdash; micropyro 0.1.post1+g96ccc73 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="External calibration" href="external-calibration.html" />
    <link rel="prev" title="Read experimental matrix" href="experiment-reader.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> micropyro
          

          
          </a>

          
            
            
              <div class="version">
                0.1.post1+g96ccc73
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="loading-module.html">Loading Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="read-database.html">Read a Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="read-blob.html">Read a Blob File</a></li>
<li class="toctree-l1"><a class="reference internal" href="experiment-reader.html">Read experimental matrix</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Compute yields</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-internal-standard-is">Using Internal Standard (IS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-a-reference-compound">Using a reference compound</a></li>
<li class="toctree-l2"><a class="reference internal" href="#internal-logic">Internal logic</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="external-calibration.html">External calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="post-processing.html">Post processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="min_versions.html">Requires</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">micropyro</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Compute yields</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/compute-yields.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compute-yields">
<h1>Compute yields<a class="headerlink" href="#compute-yields" title="Permalink to this headline">¶</a></h1>
<p>The objective of this code is to actually compute the yields from the different compounds.
This can be done using different methods: using an internal standard, or <em>a-posteriori</em> calibration using one of the products.</p>
<div class="section" id="using-internal-standard-is">
<h2>Using Internal Standard (IS)<a class="headerlink" href="#using-internal-standard-is" title="Permalink to this headline">¶</a></h2>
<p>To do so, we use the function <code class="code docutils literal notranslate"><span class="pre">compute_yields_is</span></code>.
We need to pass the experimental matrix row and the blob file dataframes to the function, as well as the name of the IS.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">compute_yields_is</span><span class="p">(</span><span class="n">experiment_df_row</span><span class="o">=</span><span class="n">experiment_df_row</span><span class="p">,</span> <span class="n">blob_df</span><span class="o">=</span><span class="n">blob_file</span><span class="p">,</span> <span class="n">internal_standard_name</span><span class="o">=</span><span class="s1">&#39;fluoranthene&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will add several columns to the blob_file dataframe. See below:</p>
<dl class="py function">
<dt id="micropyro.compute_yields_is">
<code class="sig-prename descclassname">micropyro.</code><code class="sig-name descname">compute_yields_is</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiment_df_row</span></em>, <em class="sig-param"><span class="n">blob_df</span></em>, <em class="sig-param"><span class="n">internal_standard_name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/micropyro/compute_yields.html#compute_yields_is"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#micropyro.compute_yields_is" title="Permalink to this definition">¶</a></dt>
<dd><p>Particular function to compute the yields using an IS.
The IS will be removed from the blob_df, but the yields will be based on its mass.
For the implementation, see compute_yields.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><dl class="simple">
<dt>blob_df: df</dt><dd><p>Dataframe with the blobs, with the extra column of yields</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p>To save the results, we export them to a csv file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">save_results_yields</span><span class="p">(</span><span class="n">blob_df</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Internally, <code class="code docutils literal notranslate"><span class="pre">compute_yields_is</span></code> uses a support function to define the IS.
Normally, the user does not need to access it.</p>
<dl class="py function">
<dt id="micropyro.define_internal_standard">
<code class="sig-prename descclassname">micropyro.</code><code class="sig-name descname">define_internal_standard</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiment_df_row</span></em>, <em class="sig-param"><span class="n">blob_df</span></em>, <em class="sig-param"><span class="n">internal_standard_name</span></em>, <em class="sig-param"><span class="n">calibration_file</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/micropyro/compute_yields.html#define_internal_standard"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#micropyro.define_internal_standard" title="Permalink to this definition">¶</a></dt>
<dd><p>Grabs the internal standard from the blob_df and from the experiment df to
combine them and have all the required data together.
This function is not usually used directly, but by compute_yields_is.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>experiment_df_row: df row.</strong></dt><dd><p>of the experiment being analyzed.</p>
</dd>
<dt><strong>blob_df: df</strong></dt><dd><p>dataframe after being processed with.</p>
</dd>
<dt><strong>internal_standard_name: str</strong></dt><dd><p>Name of the internal standard compound.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>internal_standard: df row</dt><dd><p>Data of the internal standard in a pandas dataframe row.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="using-a-reference-compound">
<h2>Using a reference compound<a class="headerlink" href="#using-a-reference-compound" title="Permalink to this headline">¶</a></h2>
<p>To do so, we use the function <code class="code docutils literal notranslate"><span class="pre">compute_yields_calib</span></code>. It is actually quite similar to the previous.
However, in this case, we pass the experimental matrix row and the blob file dataframes to the function,
the name of the calibration file, the reference compound for which calibration was done,
and if any compound needs to be dropped from the blob dataframe. The possibility of dropping is due to the fact
that sometimes we use also the IS, and we do not want it in the yields computation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">compute_yields_calibration</span><span class="p">(</span><span class="n">experiment_df_row</span><span class="o">=</span><span class="n">experiment_df_row</span><span class="p">,</span> <span class="n">blob_df</span><span class="o">=</span><span class="n">blob_file</span><span class="p">,</span> <span class="n">calibration_file</span><span class="o">=</span><span class="s1">&#39;phenol_calibration.json&#39;</span><span class="p">,</span>
                       <span class="n">compound_drop</span><span class="o">=</span><span class="s1">&#39;fluoranthene&#39;</span><span class="p">,</span> <span class="n">reference_compound</span><span class="o">=</span><span class="s1">&#39;phenol&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will add several columns to the blob_file dataframe. See below:</p>
<dl class="py function">
<dt id="micropyro.compute_yields_calibration">
<code class="sig-prename descclassname">micropyro.</code><code class="sig-name descname">compute_yields_calibration</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiment_df_row</span></em>, <em class="sig-param"><span class="n">blob_df</span></em>, <em class="sig-param"><span class="n">reference_compound</span></em>, <em class="sig-param"><span class="n">calibration_file</span></em>, <em class="sig-param"><span class="n">compound_drop</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/micropyro/compute_yields.html#compute_yields_calibration"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#micropyro.compute_yields_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>Particular function to compute the yields using a calibration curve of a reference compound.
In this case, the mass of reference compound is computed using an the auxiliary function get_mass_calibration.
User can still define compound_drop since in many cases, one uses both an external calibration and an Internal Standard.
For the implementation, see compute_yields.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><dl class="simple">
<dt>blob_df: df</dt><dd><p>Dataframe with the blobs, with the extra column of yields</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p>To save the results, we export them to a csv file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">save_results_yields</span><span class="p">(</span><span class="n">blob_df</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Internally, <code class="code docutils literal notranslate"><span class="pre">compute_yields_is</span></code> uses a support function to compute the mass from the calibration curve.
Normally, the user does not need to access it.</p>
<dl class="py function">
<dt id="micropyro.get_mass_calibration">
<code class="sig-prename descclassname">micropyro.</code><code class="sig-name descname">get_mass_calibration</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">calibration_file</span></em>, <em class="sig-param"><span class="n">volume</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/micropyro/compute_yields.html#get_mass_calibration"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#micropyro.get_mass_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>This function computes the mass given a calibration curve: mass = a / vol.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>calibration_file: str</strong></dt><dd><p>filename of the json file with the slope of the calibration curve</p>
</dd>
<dt><strong>volume: float</strong></dt><dd><p>volume of the blob from GC Image</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>mass_IS: float</dt><dd><p>mass of the compound used as refernece.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="internal-logic">
<h2>Internal logic<a class="headerlink" href="#internal-logic" title="Permalink to this headline">¶</a></h2>
<p>Both IS method and linear calibration use the same function to compute. In the first, the mass of IS is obtained
directly, while in the second it is computed through the calibration file.
A description of the actual function doing the job is found below:</p>
<dl class="py function">
<dt id="micropyro.compute_yields">
<code class="sig-prename descclassname">micropyro.</code><code class="sig-name descname">compute_yields</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiment_df_row</span></em>, <em class="sig-param"><span class="n">blob_df</span></em>, <em class="sig-param"><span class="n">internal_standard_name</span></em>, <em class="sig-param"><span class="n">calibration_file</span></em>, <em class="sig-param"><span class="n">compound_drop</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/micropyro/compute_yields.html#compute_yields"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#micropyro.compute_yields" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic function to compute the yields of an experiment from an internal standard.
Requires the experiment, the blob file and the name of the internal standard used.
User does not have to use this function, but the particular ones below.
Updates teh blob_df adding the following columns:</p>
<ul class="simple">
<li><p><strong>moles ecn</strong>: moles of compound using the ecn method.</p></li>
<li><p><strong>moles mrf</strong>: moles of compound using the mrf method.</p></li>
<li><p><strong>mass mrf</strong>: mass (mg) of compound using mrf method.</p></li>
<li><p><strong>yield mrf</strong>: % wrt sample mass.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>experiment_df_row: row of a dataframe</strong></dt><dd><p>with experiments from micropyrolysis. Created using ReadExperimentTable.</p>
</dd>
<dt><strong>blob_df: df</strong></dt><dd><p>with the blobs after performing the database matching.</p>
</dd>
<dt><strong>internal_standard_name: str</strong></dt><dd><p>name of the internal standard used.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>blob_df</dt><dd><p>with updated columns</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p>To save the results, we also use the same function:</p>
<dl class="py function">
<dt id="micropyro.save_results_yields">
<code class="sig-prename descclassname">micropyro.</code><code class="sig-name descname">save_results_yields</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">blob_df</span></em>, <em class="sig-param"><span class="n">filename</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/micropyro/compute_yields.html#save_results_yields"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#micropyro.save_results_yields" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the resulting blob_df to a new file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>blob_df: df</strong></dt><dd></dd>
<dt><strong>filename: str</strong></dt><dd><p>name of the output file.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="external-calibration.html" class="btn btn-neutral float-right" title="External calibration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="experiment-reader.html" class="btn btn-neutral float-left" title="Read experimental matrix" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Francisco Torres

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>